<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.push.api.client.mapper.TokenMapper">

    <update id="updateToken" parameterType="HashMap">
        update user_token_info
        set reg_dt = #{reg_dt},
            login_status = #{login_status},
            notification_status = (select notification_status from user_notification_status where user_id = #{user_id})
        where 1=1
            and project_id = #{project_id}
            and user_id = #{user_id}
            and device_token = #{device_token}
    </update>

    <insert id="insertToken" parameterType="HashMap">
        insert into user_token_info(project_id, user_id, device_token, user_type, platform, reg_dt, notification_status, login_status)
        values (#{project_id},#{user_id},#{device_token},#{user_type},#{platform},#{reg_dt},#{notification_status},#{login_status})
    </insert>

    <insert id="insertNotificationStatus" parameterType="HashMap">
        insert into user_notification_status(project_id,user_id,notification_status)
        values (#{project_id},#{user_id},#{notification_status}) on duplicate key update notification_status = #{notification_status}
    </insert>

    <update id="deleteToken" parameterType="HashMap">
        update user_token_info
        set notification_status = #{notification_status},
            login_status = #{login_status}
        where 1=1
            and project_id = #{project_id}
            and user_id = #{user_id}
            and device_token = #{device_token}
    </update>

    <update id="updateNotificationStatus" parameterType="HashMap">
        update
            user_token_info as a,
            user_notification_status as b
        set
            a.notification_status = #{notification_status},
            b.notification_status = #{notification_status}
        where 1=1
            and a.project_id = #{project_id}
            and a.user_id = #{user_id}
            and b.project_id = #{project_id}
            and b.user_id = #{user_id}
    </update>

</mapper>
